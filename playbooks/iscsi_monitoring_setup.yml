---
- name: Prepare controller variables
  import_playbook: setup_scenarios_controller.yml

- name: Prepare variables
  hosts: localhost
  environment:
    OS_CLIENT_CONFIG_FILE: "{{ clouds_yaml_file }}"
  vars:
    scenario_name: "iscsi_monitoring"
    terraform_base_dir: "terraform"
    requirements: "requirements.txt"
    network_id: "{{ hostvars.localhost.network_id }}"
    router_id: "{{ hostvars.localhost.router_id }}"
    subnet_id: "{{ hostvars.localhost.subnet_id }}"
  roles:
    - build_infrastructure
  tasks:
  - name: Register build result
    set_fact:
      iscsi_initiator_instance_ip: "{{ tf_output.outputs['iscsi_initiator_instance_ip'].value }}"
      iscsi_target_instance_ip: "{{ tf_output.outputs['iscsi_target_instance_ip'].value }}"
